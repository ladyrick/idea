<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>C++ Puzzle | LadyRick's idea</title><meta name=keywords content><meta name=description content="本文搜集了一些有趣的 C++的题目，有些题目令人大跌眼镜。来看看！"><meta name=author content="LadyRick"><link rel=canonical href=https://idea.ladyrick.com/posts/c++-puzzle/><link crossorigin=anonymous href=/assets/css/stylesheet.4398b09e795c3aac93a04f4160281925a588bcdf14941ead87ab7bfe555ba854.css integrity="sha256-Q5iwnnlcOqyToE9BYCgZJaWIvN8UlB6th6t7/lVbqFQ=" rel="preload stylesheet" as=style><link rel=icon href=https://idea.ladyrick.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://idea.ladyrick.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://idea.ladyrick.com/favicon-32x32.png><link rel=apple-touch-icon href=https://idea.ladyrick.com/apple-touch-icon.png><link rel=mask-icon href=https://idea.ladyrick.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="C++ Puzzle"><meta property="og:description" content="本文搜集了一些有趣的 C++的题目，有些题目令人大跌眼镜。来看看！"><meta property="og:type" content="article"><meta property="og:url" content="https://idea.ladyrick.com/posts/c++-puzzle/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-24T22:07:19+08:00"><meta property="article:modified_time" content="2018-06-24T22:07:19+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="C++ Puzzle"><meta name=twitter:description content="本文搜集了一些有趣的 C++的题目，有些题目令人大跌眼镜。来看看！"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://idea.ladyrick.com/posts/"},{"@type":"ListItem","position":2,"name":"C++ Puzzle","item":"https://idea.ladyrick.com/posts/c++-puzzle/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"C++ Puzzle","name":"C\u002b\u002b Puzzle","description":"本文搜集了一些有趣的 C++的题目，有些题目令人大跌眼镜。来看看！\n","keywords":[],"articleBody":"本文搜集了一些有趣的 C++的题目，有些题目令人大跌眼镜。来看看！\n请问输出结果是什么？如何解释？？ #include #define TOTAL_ELEMENTS (sizeof(array) / sizeof(array[0])) int array[] = {23, 34, 12, 17, 204, 99, 16}; int main() { for (int d = -1; d \u003c= (TOTAL_ELEMENTS - 2); d++) std::cout \u003c\u003c array[d + 1] \u003c\u003c std::endl; return 0; } 查看提示 测试发现实际输出结果为空。\nsizeof 运算符得到的是一个 size_t 类型，而 size_t 类型是无符号的。\n当用有符号数跟无符号数比较时，会将有符号数转成无符号数，也就是将-1 转成无符号数的最大值。\n另外，size_t 类型在不同位宽的机器上定义不同。如下：\n#ifdef _WIN64 __MINGW_EXTENSION typedef unsigned __int64 size_t; #else typedef unsigned int size_t; #endif /* _WIN64 */ 请问输出结果是什么？如何解释？？ #include #define f(a,b) a##b #define g(a) #a #define h(a) g(a) int main() { std::cout \u003c\u003c h(f(1,2)) \u003c\u003c std::endl; std::cout \u003c\u003c g(f(1,2)) \u003c\u003c std::endl; return 0; } 查看提示 测试发现输出结果为\n12 f(1,2) 这里首先需要知道宏定义里面#的作用。\n#： 其后必须跟一个宏参数，它的作用是将其后的参数内容转换为字符串。 ##: 它的作用是拼接两个符号，如a##1，得到a1这两个符号不必是宏参数。 然后需要了解宏替换的规则。\n如果宏定义中没有#或者##，则先展开参数再进行替换(跟嵌套的函数调用一样) 否则，参数不展开而是直接替换 在本题中，h(a)的定义中没有#或者##，所以宏定义展开流程是：\n展开f(1,2) -\u003e 得到12 -\u003e 展开h(12) -\u003e 得到g(12) -\u003e 展开g(12)发现定义中有# -\u003e 直接替换，得到\"12\"\n而g(a)的定义中有#或者##，因此会直接替换，在参数两边加上引号，不论参数是什么。于是直接得到字符串\"f(1,2)\"\n程序会输出None吗？ #include int main() { int a = 3; switch (a) { case 1: std::cout \u003c\u003c \"ONE\"; break; case 2: std::cout \u003c\u003c \"TWO\"; break; defalut: std::cout \u003c\u003c \"NONE\"; } return 0; } 查看提示 测试发现输出结果为空。\n这个问题其实在于default拼写错误，写成了defalut 。\n但是真正可怕的是，不像是其它类型的拼写错误，本题的拼写错误，编译没有任何问题，没有人提示你defalut未定义。\n它们相等吗？ #include int main() { double f = 0.0; int i; for (i = 0; i \u003c 10; i++) f = f + 0.1; if (f == 1.0) printf(\"f is 1.0\\n\"); else printf(\"f is NOT 1.0\\n\"); return 0; } 查看提示 测试发现输出结果显示 0.1 累加 10 次并不等于 1.0。\n这是因为计算机中的浮点数，包括float和double类型，都是不精确的。因此累加的话会产生累积误差。\n计算机中浮点数比较，不要直接用==比较，应该计算两者的差，当差小于某个阈值时认为相等。\n比较经典的例子是 0.1 + 0.2 != 0.3\n逗号表达式可以正确赋值吗？ #include int main() { int a = 1, 2; std::cout \u003c\u003c \"a : \" \u003c\u003c a; return 0; } 查看提示 编译错误。\n逗号表达式在 C++中的运算优先级是最低的，因此，赋值运算会优先执行，导致编译器认为2是一个表达式，编译错误。\n正确的写法是\nint a = (1, 2); 输出结果是什么？ #include #define SIZE 10 void size(int arr[SIZE]) { std::cout \u003c\u003c \"size of array is:\" \u003c\u003c sizeof(arr); } int main() { int arr[SIZE]; size(arr); return 0; } 查看提示 输出结果首先不是 40。事实上，如果你自己编译了的话，就可以看到显示的警告。\nwarning: 'sizeof' on array function parameter 'arr' will return size of 'int*' [-Wsizeof-array-argument] 也就是说，虽然形参中定义的是数组，但是在函数中使用sizeof，还是会当作指针来计算。\n在我的机器上，输出为 8，因为我的是 64 位机器。\n为什么会产生编译错误？ 记住，将一个普通指针传递给 const 类型的指针是允许的。\nvoid foo(const char **p) {} int main(int argc, char **argv) { foo(argv); return 0; } 查看提示 因为这是二级指针，必须先强制类型转换才可以赋值。一级指针则不需要强制类型转换。\nconst char ** p的意思是，类似这样的语句是无效的:**p = 'a'。\n我们看看假如允许char**到const char**的隐式类型转换的话，会发生什么。\nint main() { // 我们假设编译器存在漏洞X，允许char** 到 const char**的隐式类型转换。 char const c = 'a'; // c是一个常量。 char* p_stupid = \u0026c; // 愚蠢的指针，直接赋值是不行的，太过于耿直，编译错误。 char* p_smart = nullptr; // 这里有一个聪明的指针，学会了利用漏洞X来修改常量c。 char const** p_jump = \u0026p_smart; // 利用漏洞X作为跳板。 *p_jump = \u0026c; // 通过跳板，让p_smart强制指向c。 // 注意这一步是最有意思的一步，因为这一步的两边都是const char*类型的，赋值完全没问题。 *p_smart = 'b'; // 因为p_smart本身并不是const char*，所以现在p_smart就可以修改c了，把系统搞崩溃。 } 注意看上述步骤，可以看到，除了char const** p_jump = \u0026p_smart;这一步，其他步骤没有任何漏洞。\n因此我们可以看到，char**到const char**的隐式类型转换是可以引发严重后果的。\n输出是什么？ #include #include #define SIZEOF(arr) (sizeof(arr)/sizeof(arr[0])) #define PrintInt(expr) printf(\"%s:%d\\n\",#expr,(expr)) int main() { /* The powers of 10 */ int pot[] = { 0001, 0010, 0100, 1000 }; int i; for (i = 0; i \u003c SIZEOF(pot); i++) PrintInt(pot[i]); return 0; } 查看提示 有了前面的关于宏定义的知识，你可能会得出，输出结果是\npot[i]:1 pot[i]:10 pot[i]:100 pot[i]:1000 但是，虽然躲过了宏定义的坑，其实还是错了，因为数组中的前三个数字带有前导 0，这意味着是 8 进制。。。\n所以正确的输出是\npot[i]:1 pot[i]:8 pot[i]:64 pot[i]:1000 输出是什么？肯定不是 10 #include #include #define PrintInt(expr) printf(\"%s : %d\\n\",#expr,(expr)) int main() { int y = 100; int *p; p = (int*)malloc(sizeof(int)); *p = 10; y = y/*p; /*dividing y by *p */; PrintInt(y); return 0; } 查看提示 这道题需要注意的是y = y/*p;。\n如果是手写代码，或者没有代码高亮，可能确实会以为是y除以*p。\n但是一旦有了代码高亮，瞬间就能看出，/*p其实是形成了块注释的开头。因此并不会执行除法。\n如何实现乘 5？ #include #define PrintInt(expr) printf(\"%s : %d\\n\",#expr,(expr)) int FiveTimes(int a) { int t; t = a \u003c\u003c 2 + a; return t; } int main() { int a = 1, b = 2, c = 3; PrintInt(FiveTimes(a)); PrintInt(FiveTimes(b)); PrintInt(FiveTimes(c)); return 0; } 查看提示 需要注意的是移位运算符的优先级低于加法，因此得到了错误的结果。\n这个程序哪里有问题？ #include #include int main() { int *ptr1, ptr2; ptr1 = (int *) malloc(sizeof(int)); ptr2 = ptr1; *ptr2 = 10; return 0; } 查看提示 定义指针类型，必须每个变量前面都加*。\n修改：\nint *ptr1, *ptr2; 这个程序可以运行吗？ #include int main() { int a = 3, b = 5; printf(\u0026a[\"Ya!Hello! how is this? %s\\n\"], \u0026b[\"junk/super\"]); printf(\u0026a[\"WHAT%c%c%c %c%c %c !\\n\"], 1[\"this\"], 2[\"beauty\"], 0[\"tool\"], 0[\"is\"], 3[\"sensitive\"], 4[\"CCCCCC\"]); return 0; } 查看提示 是可以运行的。我们知道，数组下标引用a[3]，其实相当于是*(a+3)。因此，a[3]也可以写成3[a]。\n因此，a[\"Ya!Hello! how is this? %s\\n\"]相当于是\"Ya!Hello! how is this? %s\\n\"[3]。\noffsetof的原理是什么？ #include #define offsetof(a, b) ((size_t)(\u0026(((a*)(0))-\u003eb))) struct test { int a; double b; float c; int d[20]; }; int main() { printf(\"%d\\n\", offsetof(test, a)); printf(\"%d\\n\", offsetof(test, b)); printf(\"%d\\n\", offsetof(test, c)); printf(\"%d\\n\", offsetof(test, d)); } 查看提示 工作原理：\n( (size_t)( // 4. \u0026( ( // 3. (a*)(0) // 1. )-\u003eb ) // 2. ) ) Casting the value zero to the struct pointer type a* Getting the struct field b of this (illegally placed) struct object Getting the address of this b field Casting the address to a size_t 注意，现在已经不用这个了，用的是 stddef.h 自带的offsetof宏。它直接调用了编译器提供的函数__builtin_offsetof。 直接include 就可以使用了。\nSWAP宏是如何工作的？ #include #define SWAP(a, b) ((a) ^= (b) ^= (a) ^= (b)) int main() { int a = 1; int b = 2; SWAP(a, b); std::cout \u003c\u003c a \u003c\u003c b; } 查看提示 可以把(a) ^= (b) ^= (a) ^= (b)展开来看。这个表达式，相当于以下三条语句依次执行的结果。\na = a ^ b; b = b ^ a; a = a ^ b; 进行一些代换，得到：\nint _a = a; int _b = b; a = _a ^ _b; b = _b ^ (_a ^ _b); a = (_a ^ _b) ^ (_b ^ (_a ^ _b)); 根据结合律，去掉所有括号。再根据交换律，以及x^x恒等于 0，可以化简为：\nb = _a; a = _b; 因此该表达式可以实现交换两个变量的功能。\n","wordCount":"794","inLanguage":"zh","datePublished":"2018-06-24T22:07:19+08:00","dateModified":"2018-06-24T22:07:19+08:00","author":[{"@type":"Person","name":"LadyRick"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://idea.ladyrick.com/posts/c++-puzzle/"},"publisher":{"@type":"Organization","name":"LadyRick's idea","logo":{"@type":"ImageObject","url":"https://idea.ladyrick.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://idea.ladyrick.com/ accesskey=h title="LadyRick's idea (Alt + H)">LadyRick's idea</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://idea.ladyrick.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://idea.ladyrick.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://idea.ladyrick.com/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://idea.ladyrick.com/>主页</a>&nbsp;»&nbsp;<a href=https://idea.ladyrick.com/posts/>Posts</a></div><h1 class=post-title>C++ Puzzle</h1><div class=post-meta><span title='2018-06-24 22:07:19 +0800 CST'>六月 24, 2018</span>&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;LadyRick&nbsp;|&nbsp;<a href=https://github.com/ladyrick/idea/blob/main/content/posts/C++%20Puzzle.md rel="noopener noreferrer" target=_blank>帮助改进</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e8%af%b7%e9%97%ae%e8%be%93%e5%87%ba%e7%bb%93%e6%9e%9c%e6%98%af%e4%bb%80%e4%b9%88%e5%a6%82%e4%bd%95%e8%a7%a3%e9%87%8a aria-label=请问输出结果是什么？如何解释？？>请问输出结果是什么？如何解释？？</a></li><li><a href=#%e8%af%b7%e9%97%ae%e8%be%93%e5%87%ba%e7%bb%93%e6%9e%9c%e6%98%af%e4%bb%80%e4%b9%88%e5%a6%82%e4%bd%95%e8%a7%a3%e9%87%8a-1 aria-label=请问输出结果是什么？如何解释？？>请问输出结果是什么？如何解释？？</a></li><li><a href=#%e7%a8%8b%e5%ba%8f%e4%bc%9a%e8%be%93%e5%87%banone%e5%90%97 aria-label=程序会输出None吗？>程序会输出<code>None</code>吗？</a></li><li><a href=#%e5%ae%83%e4%bb%ac%e7%9b%b8%e7%ad%89%e5%90%97 aria-label=它们相等吗？>它们相等吗？</a></li><li><a href=#%e9%80%97%e5%8f%b7%e8%a1%a8%e8%be%be%e5%bc%8f%e5%8f%af%e4%bb%a5%e6%ad%a3%e7%a1%ae%e8%b5%8b%e5%80%bc%e5%90%97 aria-label=逗号表达式可以正确赋值吗？>逗号表达式可以正确赋值吗？</a></li><li><a href=#%e8%be%93%e5%87%ba%e7%bb%93%e6%9e%9c%e6%98%af%e4%bb%80%e4%b9%88 aria-label=输出结果是什么？>输出结果是什么？</a></li><li><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e4%bc%9a%e4%ba%a7%e7%94%9f%e7%bc%96%e8%af%91%e9%94%99%e8%af%af aria-label=为什么会产生编译错误？>为什么会产生编译错误？</a></li><li><a href=#%e8%be%93%e5%87%ba%e6%98%af%e4%bb%80%e4%b9%88 aria-label=输出是什么？>输出是什么？</a></li><li><a href=#%e8%be%93%e5%87%ba%e6%98%af%e4%bb%80%e4%b9%88%e8%82%af%e5%ae%9a%e4%b8%8d%e6%98%af-10 aria-label="输出是什么？肯定不是 10">输出是什么？肯定不是 10</a></li><li><a href=#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e4%b9%98-5 aria-label="如何实现乘 5？">如何实现乘 5？</a></li><li><a href=#%e8%bf%99%e4%b8%aa%e7%a8%8b%e5%ba%8f%e5%93%aa%e9%87%8c%e6%9c%89%e9%97%ae%e9%a2%98 aria-label=这个程序哪里有问题？>这个程序哪里有问题？</a></li><li><a href=#%e8%bf%99%e4%b8%aa%e7%a8%8b%e5%ba%8f%e5%8f%af%e4%bb%a5%e8%bf%90%e8%a1%8c%e5%90%97 aria-label=这个程序可以运行吗？>这个程序可以运行吗？</a></li><li><a href=#offsetof%e7%9a%84%e5%8e%9f%e7%90%86%e6%98%af%e4%bb%80%e4%b9%88 aria-label=offsetof的原理是什么？><code>offsetof</code>的原理是什么？</a></li><li><a href=#swap%e5%ae%8f%e6%98%af%e5%a6%82%e4%bd%95%e5%b7%a5%e4%bd%9c%e7%9a%84 aria-label=SWAP宏是如何工作的？><code>SWAP</code>宏是如何工作的？</a></li></ul></div></details></div><div class=post-content><p>本文搜集了一些有趣的 C++的题目，有些题目令人大跌眼镜。来看看！</p><script>function toggle(e){var t=e.parentElement.getElementsByClassName("cpuzzle-hint")[0],n=t.style.display;n=="none"?(t.style.display="block",e.textContent="关闭提示"):(t.style.display="none",e.textContent="查看提示")}</script><h2 id=请问输出结果是什么如何解释>请问输出结果是什么？如何解释？？<a hidden class=anchor aria-hidden=true href=#请问输出结果是什么如何解释>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define TOTAL_ELEMENTS (sizeof(array) / sizeof(array[0]))
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>array</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>23</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>204</span><span class=p>,</span> <span class=mi>99</span><span class=p>,</span> <span class=mi>16</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>d</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=n>d</span> <span class=o>&lt;=</span> <span class=p>(</span><span class=n>TOTAL_ELEMENTS</span> <span class=o>-</span> <span class=mi>2</span><span class=p>);</span> <span class=n>d</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>array</span><span class=p>[</span><span class=n>d</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>测试发现实际输出结果为空。</p><p>sizeof 运算符得到的是一个 size_t 类型，而 size_t 类型是无符号的。</p><p>当用有符号数跟无符号数比较时，会将有符号数转成无符号数，也就是将-1 转成无符号数的最大值。</p><p>另外，size_t 类型在不同位宽的机器上定义不同。如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#ifdef _WIN64
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=n>__MINGW_EXTENSION</span> <span class=k>typedef</span> <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>size_t</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>typedef</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>size_t</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=cm>/* _WIN64 */</span><span class=cp>
</span></span></span></code></pre></div></div></div><hr><h2 id=请问输出结果是什么如何解释-1>请问输出结果是什么？如何解释？？<a hidden class=anchor aria-hidden=true href=#请问输出结果是什么如何解释-1>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#define f(a,b) a##b
</span></span></span><span class=line><span class=cl><span class=cp>#define g(a) #a
</span></span></span><span class=line><span class=cl><span class=cp>#define h(a) g(a)
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>h</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>))</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>g</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>))</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>测试发现输出结果为</p><pre tabindex=0><code>12
f(1,2)
</code></pre><p>这里首先需要知道宏定义里面<code>#</code>的作用。</p><ol><li><code>#</code>： 其后必须跟一个宏参数，它的作用是将其后的参数内容转换为字符串。</li><li><code>##</code>: 它的作用是拼接两个符号，如<code>a##1</code>，得到<code>a1</code>这两个符号不必是宏参数。</li></ol><p>然后需要了解宏替换的规则。</p><ol><li>如果宏定义中没有<code>#</code>或者<code>##</code>，则先展开参数再进行替换(跟嵌套的函数调用一样)</li><li>否则，参数不展开而是直接替换</li></ol><p>在本题中，<code>h(a)</code>的定义中没有<code>#</code>或者<code>##</code>，所以宏定义展开流程是：</p><p>展开<code>f(1,2)</code> -> 得到<code>12</code> -> 展开<code>h(12)</code> -> 得到<code>g(12)</code> -> 展开<code>g(12)</code>发现定义中有<code>#</code> -> 直接替换，得到<code>"12"</code></p><p>而<code>g(a)</code>的定义中有<code>#</code>或者<code>##</code>，因此会直接替换，在参数两边加上引号，不论参数是什么。于是直接得到字符串<code>"f(1,2)"</code></p></div></div><hr><h2 id=程序会输出none吗>程序会输出<code>None</code>吗？<a hidden class=anchor aria-hidden=true href=#程序会输出none吗>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;ONE&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;TWO&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nl>defalut</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;NONE&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>测试发现输出结果为空。</p><p>这个问题其实在于<code>default</code>拼写错误，写成了<code>defalut</code> 。</p><p>但是真正可怕的是，不像是其它类型的拼写错误，本题的拼写错误，编译没有任何问题，没有人提示你<code>defalut</code>未定义。</p></div></div><hr><h2 id=它们相等吗>它们相等吗？<a hidden class=anchor aria-hidden=true href=#它们相等吗>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>f</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span> <span class=o>=</span> <span class=n>f</span> <span class=o>+</span> <span class=mf>0.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>f</span> <span class=o>==</span> <span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;f is 1.0</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;f is NOT 1.0</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>测试发现输出结果显示 0.1 累加 10 次并不等于 1.0。</p><p>这是因为计算机中的浮点数，包括<code>float</code>和<code>double</code>类型，都是不精确的。因此累加的话会产生累积误差。</p><p>计算机中浮点数比较，不要直接用<code>==</code>比较，应该计算两者的差，当差小于某个阈值时认为相等。</p><p>比较经典的例子是 <code>0.1 + 0.2 != 0.3</code></p></div></div><hr><h2 id=逗号表达式可以正确赋值吗>逗号表达式可以正确赋值吗？<a hidden class=anchor aria-hidden=true href=#逗号表达式可以正确赋值吗>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;a : &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>编译错误。</p><p>逗号表达式在 C++中的运算优先级是最低的，因此，赋值运算会优先执行，导致编译器认为<code>2</code>是一个表达式，编译错误。</p><p>正确的写法是</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
</span></span></code></pre></div></div></div><hr><h2 id=输出结果是什么>输出结果是什么？<a hidden class=anchor aria-hidden=true href=#输出结果是什么>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define SIZE 10
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>size</span><span class=p>(</span><span class=kt>int</span> <span class=n>arr</span><span class=p>[</span><span class=n>SIZE</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;size of array is:&#34;</span> <span class=o>&lt;&lt;</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>arr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>arr</span><span class=p>[</span><span class=n>SIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>size</span><span class=p>(</span><span class=n>arr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>输出结果首先不是 40。事实上，如果你自己编译了的话，就可以看到显示的警告。</p><pre tabindex=0><code>warning: &#39;sizeof&#39; on array function parameter &#39;arr&#39; will return size of &#39;int*&#39; [-Wsizeof-array-argument]
</code></pre><p>也就是说，虽然形参中定义的是数组，但是在函数中使用<code>sizeof</code>，还是会当作指针来计算。</p><p>在我的机器上，输出为 8，因为我的是 64 位机器。</p></div></div><hr><h2 id=为什么会产生编译错误>为什么会产生编译错误？<a hidden class=anchor aria-hidden=true href=#为什么会产生编译错误>#</a></h2><p>记住，将一个普通指针传递给 const 类型的指针是允许的。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=kt>void</span> <span class=nf>foo</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>p</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>foo</span><span class=p>(</span><span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>因为这是二级指针，必须先强制类型转换才可以赋值。一级指针则不需要强制类型转换。</p><p><code>const char ** p</code>的意思是，类似这样的语句是无效的:<code>**p = 'a'</code>。</p><p>我们看看假如允许<code>char**</code>到<code>const char**</code>的隐式类型转换的话，会发生什么。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 我们假设编译器存在漏洞X，允许char** 到 const char**的隐式类型转换。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=k>const</span> <span class=n>c</span> <span class=o>=</span> <span class=sc>&#39;a&#39;</span><span class=p>;</span> <span class=c1>// c是一个常量。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span><span class=o>*</span> <span class=n>p_stupid</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>c</span><span class=p>;</span> <span class=c1>// 愚蠢的指针，直接赋值是不行的，太过于耿直，编译错误。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span><span class=o>*</span> <span class=n>p_smart</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span> <span class=c1>// 这里有一个聪明的指针，学会了利用漏洞X来修改常量c。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=k>const</span><span class=o>**</span> <span class=n>p_jump</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>p_smart</span><span class=p>;</span> <span class=c1>// 利用漏洞X作为跳板。
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>p_jump</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>c</span><span class=p>;</span> <span class=c1>// 通过跳板，让p_smart强制指向c。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 注意这一步是最有意思的一步，因为这一步的两边都是const char*类型的，赋值完全没问题。
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>p_smart</span> <span class=o>=</span> <span class=sc>&#39;b&#39;</span><span class=p>;</span> <span class=c1>// 因为p_smart本身并不是const char*，所以现在p_smart就可以修改c了，把系统搞崩溃。
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>注意看上述步骤，可以看到，除了<code>char const** p_jump = &p_smart;</code>这一步，其他步骤没有任何漏洞。</p><p>因此我们可以看到，<code>char**</code>到<code>const char**</code>的隐式类型转换是可以引发严重后果的。</p></div></div><hr><h2 id=输出是什么>输出是什么？<a hidden class=anchor aria-hidden=true href=#输出是什么>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define SIZEOF(arr) (sizeof(arr)/sizeof(arr[0]))
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define PrintInt(expr) printf(&#34;%s:%d\n&#34;,#expr,(expr))
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* The powers of 10 */</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>pot</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=mo>0001</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mo>0010</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mo>0100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>1000</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>SIZEOF</span><span class=p>(</span><span class=n>pot</span><span class=p>);</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>PrintInt</span><span class=p>(</span><span class=n>pot</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>有了前面的关于宏定义的知识，你可能会得出，输出结果是</p><pre tabindex=0><code>pot[i]:1
pot[i]:10
pot[i]:100
pot[i]:1000
</code></pre><p>但是，虽然躲过了宏定义的坑，其实还是错了，因为数组中的前三个数字带有前导 0，这意味着是 8 进制。。。</p><p>所以正确的输出是</p><pre tabindex=0><code>pot[i]:1
pot[i]:8
pot[i]:64
pot[i]:1000
</code></pre></div></div><hr><h2 id=输出是什么肯定不是-10>输出是什么？肯定不是 10<a hidden class=anchor aria-hidden=true href=#输出是什么肯定不是-10>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define PrintInt(expr) printf(&#34;%s : %d\n&#34;,#expr,(expr))
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span><span class=o>*</span><span class=p>)</span><span class=n>malloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=n>y</span><span class=cm>/*p; /*dividing y by *p */</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>PrintInt</span><span class=p>(</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>这道题需要注意的是<code>y = y/*p;</code>。</p><p>如果是手写代码，或者没有代码高亮，可能确实会以为是<code>y</code>除以<code>*p</code>。</p><p>但是一旦有了代码高亮，瞬间就能看出，<code>/*p</code>其实是形成了块注释的开头。因此并不会执行除法。</p></div></div><hr><h2 id=如何实现乘-5>如何实现乘 5？<a hidden class=anchor aria-hidden=true href=#如何实现乘-5>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define PrintInt(expr) printf(&#34;%s : %d\n&#34;,#expr,(expr))
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>FiveTimes</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>a</span> <span class=o>&lt;&lt;</span> <span class=mi>2</span> <span class=o>+</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>PrintInt</span><span class=p>(</span><span class=n>FiveTimes</span><span class=p>(</span><span class=n>a</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>PrintInt</span><span class=p>(</span><span class=n>FiveTimes</span><span class=p>(</span><span class=n>b</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>PrintInt</span><span class=p>(</span><span class=n>FiveTimes</span><span class=p>(</span><span class=n>c</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>需要注意的是移位运算符的优先级低于加法，因此得到了错误的结果。</p></div></div><hr><h2 id=这个程序哪里有问题>这个程序哪里有问题？<a hidden class=anchor aria-hidden=true href=#这个程序哪里有问题>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=o>*</span><span class=n>ptr1</span><span class=p>,</span> <span class=n>ptr2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ptr1</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span> <span class=n>malloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>ptr2</span> <span class=o>=</span> <span class=n>ptr1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>ptr2</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>定义指针类型，必须每个变量前面都加<code>*</code>。</p><p>修改：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=kt>int</span> <span class=o>*</span><span class=n>ptr1</span><span class=p>,</span> <span class=o>*</span><span class=n>ptr2</span><span class=p>;</span>
</span></span></code></pre></div></div></div><hr><h2 id=这个程序可以运行吗>这个程序可以运行吗？<a hidden class=anchor aria-hidden=true href=#这个程序可以运行吗>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=s>&#34;Ya!Hello! how is this? %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>],</span> <span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=s>&#34;junk/super&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=s>&#34;WHAT%c%c%c  %c%c  %c !</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>],</span> <span class=mi>1</span><span class=p>[</span><span class=s>&#34;this&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>           <span class=mi>2</span><span class=p>[</span><span class=s>&#34;beauty&#34;</span><span class=p>],</span> <span class=mi>0</span><span class=p>[</span><span class=s>&#34;tool&#34;</span><span class=p>],</span> <span class=mi>0</span><span class=p>[</span><span class=s>&#34;is&#34;</span><span class=p>],</span> <span class=mi>3</span><span class=p>[</span><span class=s>&#34;sensitive&#34;</span><span class=p>],</span> <span class=mi>4</span><span class=p>[</span><span class=s>&#34;CCCCCC&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>是可以运行的。我们知道，数组下标引用<code>a[3]</code>，其实相当于是<code>*(a+3)</code>。因此，<code>a[3]</code>也可以写成<code>3[a]</code>。</p><p>因此，<code>a["Ya!Hello! how is this? %s\n"]</code>相当于是<code>"Ya!Hello! how is this? %s\n"[3]</code>。</p></div></div><hr><h2 id=offsetof的原理是什么><code>offsetof</code>的原理是什么？<a hidden class=anchor aria-hidden=true href=#offsetof的原理是什么>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define offsetof(a, b) ((size_t)(&amp;(((a*)(0))-&gt;b)))
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>struct</span> <span class=nc>test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>d</span><span class=p>[</span><span class=mi>20</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>offsetof</span><span class=p>(</span><span class=n>test</span><span class=p>,</span> <span class=n>a</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>offsetof</span><span class=p>(</span><span class=n>test</span><span class=p>,</span> <span class=n>b</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>offsetof</span><span class=p>(</span><span class=n>test</span><span class=p>,</span> <span class=n>c</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>offsetof</span><span class=p>(</span><span class=n>test</span><span class=p>,</span> <span class=n>d</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>工作原理：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>size_t</span><span class=p>)(</span>      <span class=c1>// 4.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>&amp;</span><span class=p>(</span> <span class=p>(</span>         <span class=c1>// 3.
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>(</span><span class=n>a</span><span class=o>*</span><span class=p>)(</span><span class=mi>0</span><span class=p>)</span>    <span class=c1>// 1.
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=p>)</span><span class=o>-&gt;</span><span class=n>b</span> <span class=p>)</span>      <span class=c1>// 2.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><ol><li>Casting the value zero to the struct pointer type <code>a*</code></li><li>Getting the struct field <code>b</code> of this (illegally placed) struct object</li><li>Getting the address of this <code>b</code> field</li><li>Casting the address to a <code>size_t</code></li></ol><p>注意，现在已经不用这个了，用的是 stddef.h 自带的<code>offsetof</code>宏。它直接调用了编译器提供的函数<code>__builtin_offsetof</code>。
直接<code>include &lt;iostream></code>就可以使用了。</p></div></div><hr><h2 id=swap宏是如何工作的><code>SWAP</code>宏是如何工作的？<a hidden class=anchor aria-hidden=true href=#swap宏是如何工作的>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define SWAP(a, b) ((a) ^= (b) ^= (a) ^= (b))
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>SWAP</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>a</span> <span class=o>&lt;&lt;</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div><strong onclick=toggle(this) style=cursor:pointer>查看提示</strong><div class=cpuzzle-hint style="display:none;padding:10px;box-shadow:0 0 0 3px #f7f0f3 inset"><p>可以把<code>(a) ^= (b) ^= (a) ^= (b)</code>展开来看。这个表达式，相当于以下三条语句依次执行的结果。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>a</span> <span class=o>^</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>b</span> <span class=o>^</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>a</span> <span class=o>^</span> <span class=n>b</span><span class=p>;</span>
</span></span></code></pre></div><p>进行一些代换，得到：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=kt>int</span> <span class=n>_a</span> <span class=o>=</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>_b</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>_a</span> <span class=o>^</span> <span class=n>_b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>_b</span> <span class=o>^</span> <span class=p>(</span><span class=n>_a</span> <span class=o>^</span> <span class=n>_b</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=n>_a</span> <span class=o>^</span> <span class=n>_b</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>_b</span> <span class=o>^</span> <span class=p>(</span><span class=n>_a</span> <span class=o>^</span> <span class=n>_b</span><span class=p>));</span>
</span></span></code></pre></div><p>根据结合律，去掉所有括号。再根据交换律，以及<code>x^x</code>恒等于 0，可以化简为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>_a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>_b</span><span class=p>;</span>
</span></span></code></pre></div><p>因此该表达式可以实现交换两个变量的功能。</p></div></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://idea.ladyrick.com/posts/%E6%95%B0%E7%BB%84%E5%89%8Dk%E5%B0%8F%E5%85%83%E7%B4%A0%E7%9A%84%E5%90%84%E7%A7%8D%E6%96%B9%E6%B3%95%E5%AF%B9%E6%AF%94/><span class=title>« 上一页</span><br><span>数组前k小元素的各种方法对比</span></a>
<a class=next href=https://idea.ladyrick.com/posts/%E4%BD%BF%E7%94%A8travis%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo%E5%8D%9A%E5%AE%A2%E5%88%B0github-pages/><span class=title>下一页 »</span><br><span>使用travis自动部署hexo博客到github pages</span></a></nav></footer><script id=load-utterance>(()=>{const t=()=>document.body.className.split(" ").includes("dark")?"github-dark":"github-light",e=document.createElement("script");e.src="https://utteranc.es/client.js",e.setAttribute("theme",t()),e.setAttribute("repo","ladyrick/idea"),e.setAttribute("issue-term","title"),e.setAttribute("crossorigin","anonymous"),e.setAttribute("url",decodeURIComponent(location.href).replace(location.origin,"https://idea.ladyrick.com")),e.setAttribute("origin","https://idea.ladyrick.com");const n=document.querySelector("#load-utterance");n.parentElement.insertBefore(e,n);const s=()=>{const e=document.querySelector(".utterances-frame");if(e){const n=t()==="github-dark"?"github-light":"github-dark",s={type:"set-theme",theme:n};e.contentWindow.postMessage(s,"https://utteranc.es")}},o=document.querySelector("#theme-toggle");o.addEventListener("click",s,!1)})()</script></article></main><footer class=footer><span>&copy; 2022 <a href=https://idea.ladyrick.com/>LadyRick's idea</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>